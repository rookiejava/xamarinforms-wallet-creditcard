<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="XFWallet.MainPage"
    xmlns="http://xamarin.com/schemas/2014/forms"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:cardView="clr-namespace:PanCardView;assembly=PanCardView"
    xmlns:controls="clr-namespace:PanCardView.Controls;assembly=PanCardView"
    xmlns:d="http://xamarin.com/schemas/2014/forms/design"
    xmlns:ios="clr-namespace:Xamarin.Forms.PlatformConfiguration.iOSSpecific;assembly=Xamarin.Forms.Core"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="clr-namespace:XFWallet.Models"
    xmlns:pancakeView="clr-namespace:Xamarin.Forms.PancakeView;assembly=Xamarin.Forms.PancakeView"
    xmlns:proc="clr-namespace:PanCardView.Processors;assembly=PanCardView"
    xmlns:renderers="clr-namespace:XFWallet.Renderers"
    xmlns:viewmodels="clr-namespace:XFWallet.ViewModels"
    ios:Page.UseSafeArea="True"
    x:DataType="viewmodels:MainPageViewModel"
    BackgroundColor="Black"
    NavigationPage.HasNavigationBar="False"
    mc:Ignorable="d">


    <ContentPage.Resources>
        <ResourceDictionary>
            <Style x:Key="ActiveIndicatorColor" TargetType="Frame">
                <Setter Property="OutlineColor" Value="#4867EA" />
            </Style>
            <Style x:Key="InactiveIndicatorColor" TargetType="Frame">
                <Setter Property="OutlineColor" Value="#bdbdbd" />
            </Style>
            <Color x:Key="colorPink">#FF1577</Color>
            <Color x:Key="colorWhite">#ffffff</Color>
        </ResourceDictionary>
    </ContentPage.Resources>
    <Grid BackgroundColor="Black">
        <Grid.RowDefinitions>
            <RowDefinition Height="auto" />
            <RowDefinition Height="auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <Grid
            Grid.Row="0"
            Margin="200,100,0,30"
            ColumnSpacing="100">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="auto" />
                <ColumnDefinition Width="auto" />
                <ColumnDefinition Width="auto" />
                <ColumnDefinition Width="auto" />
            </Grid.ColumnDefinitions>
            <ImageButton
                Grid.Column="0"
                Aspect="AspectFit"
                BackgroundColor="Transparent"
                HeightRequest="100"
                Source="ic_menu.png"
                WidthRequest="100" />
            <ImageButton
                Grid.Column="1"
                Aspect="AspectFit"
                BackgroundColor="Transparent"
                HeightRequest="100"
                Source="ic_heart.png"
                WidthRequest="100" />
            <ImageButton
                Grid.Column="2"
                Aspect="AspectFit"
                BackgroundColor="Transparent"
                HeightRequest="100"
                Source="ic_notification.png"
                WidthRequest="100" />
            <ImageButton
                Grid.Column="3"
                Aspect="AspectFit"
                BackgroundColor="Transparent"
                HeightRequest="100"
                Source="ic_shopping_bag.png"
                WidthRequest="100" />
            <BoxView
                Grid.Column="3"
                Margin="0,0,-3,0"
                BackgroundColor="Red"
                CornerRadius="25"
                HeightRequest="50"
                HorizontalOptions="End"
                VerticalOptions="Start"
                WidthRequest="50" />
        </Grid>
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="auto" />
            </Grid.ColumnDefinitions>
            <Image
                Grid.Column="0"
                Margin="-5,10,0,0"
                Aspect="AspectFit"
                HeightRequest="100"
                Source="ic_x_left.png"
                TranslationY="20"
                WidthRequest="100" />
            <pancakeView:PancakeView
                Grid.Column="1"
                Margin="100,100,50,50"
                Padding="{OnPlatform Android='0,6,0,0',
                                     iOS='0,2,0,2', Tizen='0,10,0,0'}"
                BackgroundColor="{StaticResource colorWhite}"
                CornerRadius="{OnPlatform Android='30',
                                          iOS='22', Tizen='75'}"
                HasShadow="False"
                HeightRequest="150">
                <Grid Padding="0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="auto" />
                    </Grid.ColumnDefinitions>
                    <renderers:CustomEntryBorderless
                        x:Name="entrySearch"
                        Grid.Column="0"
                        Margin="50,0,0,0"
                        FontFamily="Poppins-Regular"
                        FontSize="30"
                        HorizontalOptions="FillAndExpand"
                        Placeholder="Search"
                        Text="{Binding SearchText}"
                        ReturnCommand="{Binding SearchCommand}"
                        VerticalOptions="Center">
                        <renderers:CustomEntryBorderless.Keyboard>
                            <Keyboard x:FactoryMethod="Create">
                                <x:Arguments>
                                    <KeyboardFlags>None</KeyboardFlags>
                                </x:Arguments>
                            </Keyboard>
                        </renderers:CustomEntryBorderless.Keyboard>
                    </renderers:CustomEntryBorderless>
                    <ImageButton
                        Grid.Column="1"
                        Margin="{OnPlatform Android='0,-4,25,0',
                                            iOS='0,-2,25,0', Tizen='0,-4,50,0'}"
                        Aspect="AspectFit"
                        BackgroundColor="Transparent"
                        Command="{Binding SearchCommand}"
                        HeightRequest="60"
                        Source="ic_search.png"
                        WidthRequest="60">
                        <ImageButton.Triggers>
                            <DataTrigger
                                Binding="{Binding IsVisibleBtnClose}"
                                TargetType="ImageButton"
                                Value="True">
                                <Setter Property="IsVisible" Value="False" />
                            </DataTrigger>
                        </ImageButton.Triggers>
                    </ImageButton>
                    <ImageButton
                        Grid.Column="1"
                        Margin="{OnPlatform Android='0,-4,25,0',
                                            iOS='0,-2,25,0', Tizen='0,-4,50,0'}"
                        Aspect="AspectFit"
                        BackgroundColor="Transparent"
                        Command="{Binding ClearSearchTextCommand}"
                        HeightRequest="60"
                        IsVisible="{Binding IsVisibleBtnClose}"
                        Source="ic_close.png"
                        WidthRequest="60" />
                </Grid>
            </pancakeView:PancakeView>
            <Image
                Grid.Column="2"
                Margin="0,0,-5,0"
                Aspect="AspectFit"
                HeightRequest="100"
                Source="ic_x_right.png"
                WidthRequest="100" />
        </Grid>
        <ScrollView x:Name="scrollView" Grid.Row="2">
            <pancakeView:PancakeView BackgroundColor="{StaticResource colorWhite}" CornerRadius="120,120,0,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="auto" />
                        <RowDefinition Height="auto" />
                        <RowDefinition Height="auto" />
                        <RowDefinition Height="auto" />
                    </Grid.RowDefinitions>
                    <StackLayout
                        Grid.Row="0"
                        Margin="100,100,100,20"
                        Orientation="Horizontal">
                        <Label
                            FontFamily="Poppins-SemiBold"
                            FontSize="40"
                            HorizontalOptions="StartAndExpand"
                            Text="Cards" />
                        <Label
                            CharacterSpacing="2"
                            WidthRequest="200"
                            FontFamily="Poppins-Regular"
                            FontSize="40"
                            HorizontalOptions="End"
                            Text=". . ."
                            VerticalOptions="Center">
                            <Label.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding NavigateToAddCreditCardPageCommand}" NumberOfTapsRequired="1" />
                            </Label.GestureRecognizers>
                        </Label>
                    </StackLayout>
                    <cardView:CoverFlowView
                        Grid.Row="1"
                        IsCyclical="False"
                        ItemsSource="{Binding Cards}"
                        PositionShiftValue="200">
                        <x:Arguments>
                            <proc:BaseCoverFlowFrontViewProcessor RotationFactor="0.5" ScaleFactor="0.75" />
                            <proc:BaseCoverFlowBackViewProcessor ScaleFactor="0.75" />
                        </x:Arguments>
                        <cardView:CoverFlowView.ItemTemplate>
                            <DataTemplate x:DataType="models:Card">
                                <pancakeView:PancakeView
                                    Margin="150,0,150,35"
                                    BackgroundColor="{StaticResource colorWhite}"
                                    CornerRadius="400"
                                    Elevation="100"
                                    HasShadow="False"
                                    HeightRequest="1000">
                                    <Grid RowSpacing="0">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="auto" />
                                            <RowDefinition Height="*" />
                                            <RowDefinition Height="auto" />
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="auto" />
                                        </Grid.ColumnDefinitions>
                                        <Image
                                            Grid.RowSpan="3"
                                            Grid.ColumnSpan="2"
                                            Aspect="AspectFill"
                                            HorizontalOptions="FillAndExpand"
                                            Source="{Binding cardBackground}"
                                            VerticalOptions="FillAndExpand" />
                                        <Label
                                            Grid.Row="0"
                                            Grid.ColumnSpan="2"
                                            Margin="75,125,0,0"
                                            FontFamily="Poppins-SemiBold"
                                            FontSize="25"
                                            Text="Business"
                                            TextColor="{StaticResource colorWhite}"
                                            VerticalOptions="Start" />
                                        <Label
                                            Grid.Row="1"
                                            Grid.ColumnSpan="2"
                                            Margin="{OnPlatform Android='15,0,0,34',
                                                                iOS='15,0,0,38', Tizen='100,0,0,250'}"
                                            Padding="5"
                                            FontFamily="Poppins-SemiBold"
                                            FontSize="{OnPlatform Android='15',
                                                                  iOS='18', Tizen='35'}"
                                            Text="{Binding cardFakeNumber}"
                                            TextColor="{StaticResource colorWhite}"
                                            VerticalOptions="End" />
                                        <Label
                                            Grid.Row="2"
                                            Grid.ColumnSpan="2"
                                            Margin="75,0,0,100"
                                            FontFamily="Poppins-SemiBold"
                                            FontSize="35"
                                            LineBreakMode="TailTruncation"
                                            Text="{Binding cardName}"
                                            TextColor="{StaticResource colorWhite}"
                                            VerticalOptions="Center" />
                                        <Image
                                            Grid.Row="2"
                                            Grid.Column="1"
                                            Margin="0,0,75,120"
                                            Aspect="AspectFit"
                                            HeightRequest="150"
                                            Source="{Binding cardFlag}"
                                            WidthRequest="180" />
                                    </Grid>
                                </pancakeView:PancakeView>
                            </DataTemplate>
                        </cardView:CoverFlowView.ItemTemplate>
                        <controls:IndicatorsControl
                            Scale="3"
                            Padding="250,0,0,0"
                            Margin="0,20,100,0"
                            IsVisible="True"
                            WidthRequest="300"
                            HeightRequest="50"
                            SelectedIndicatorStyle="{StaticResource ActiveIndicatorColor}"
                            UnselectedIndicatorStyle="{StaticResource InactiveIndicatorColor}" />
                    </cardView:CoverFlowView>
                    <StackLayout
                        Grid.Row="2"
                        Margin="100,100,100,20"
                        Orientation="Horizontal"
                        Spacing="0">
                        <Label
                            FontFamily="Poppins-SemiBold"
                            FontSize="40"
                            HorizontalOptions="StartAndExpand"
                            Text="Latest Offers"
                            VerticalOptions="Center" />
                        <Label
                            Margin="0,2,5,0"
                            FontFamily="Poppins-Regular"
                            FontSize="20"
                            HorizontalOptions="End"
                            Text="Sort by"
                            VerticalOptions="Center" />
                        <Label
                            Margin="0,2,5,0"
                            FontFamily="Poppins-Regular"
                            FontSize="20"
                            HorizontalOptions="End"
                            Text="Recent"
                            TextColor="#2D51E9"
                            VerticalOptions="Center" />
                        <Image
                            Margin="0,2,150,0"
                            Aspect="AspectFit"
                            HeightRequest="50"
                            Source="ic_down_arrow.png"
                            VerticalOptions="Center"
                            WidthRequest="50" />
                    </StackLayout>
                    <ListView
                        x:Name="listStore"
                        Grid.Row="3"
                        Margin="200,0,200,0"
                        ItemsSource="{Binding StoresSearch}"
                        SelectionMode="None"
                        VerticalScrollBarVisibility="Never">
                        <!--<ListView.ItemsLayout>
                            <LinearItemsLayout Orientation="Vertical" />
                        </ListView.ItemsLayout>-->
                        <ListView.ItemTemplate>
                            <DataTemplate x:DataType="models:Store">
                                <ViewCell>
                                <Grid RowSpacing="0">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="*" />
                                        <RowDefinition Height="0.3" />
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="auto" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="auto" />
                                    </Grid.ColumnDefinitions>
                                    <pancakeView:PancakeView
                                        Grid.Row="0"
                                        Grid.Column="0"
                                        Margin="5,20,0,20"
                                        Padding="45"
                                        BackgroundColor="#F5F6FA"
                                        CornerRadius="50"
                                        Elevation="6"
                                        HasShadow="False">
                                        <Image
                                            Aspect="AspectFit"
                                            HeightRequest="144"
                                            Source="{Binding image}"
                                            WidthRequest="144" />
                                    </pancakeView:PancakeView>
                                    <StackLayout
                                        Grid.Row="0"
                                        Grid.Column="1"
                                        Margin="100,0,0,0"
                                        Spacing="0"
                                        VerticalOptions="Center">
                                        <Label
                                            FontFamily="Poppins-Medium"
                                            FontSize="30"
                                            LineBreakMode="TailTruncation"
                                            Text="{Binding name}" />
                                        <Label
                                            FontSize="24"
                                            Text="Just Now"
                                            TextColor="#C0C4D5" />
                                    </StackLayout>
                                    <Label
                                        Grid.Row="0"
                                        Grid.Column="2"
                                        Margin="0,-15,22,0"
                                        FontFamily="Poppins-Medium"
                                        FontSize="20"
                                        Text="Shop Now"
                                        TextColor="{StaticResource colorPink}"
                                        VerticalOptions="Center">
                                        <Label.GestureRecognizers>
                                            <TapGestureRecognizer
                                                x:DataType="{x:Null}"
                                                Command="{Binding Path=BindingContext.OpenLinkCommand, Source={x:Reference listStore}}"
                                                CommandParameter="{Binding .}"
                                                NumberOfTapsRequired="1" />
                                        </Label.GestureRecognizers>
                                    </Label>
                                    <BoxView
                                        Grid.Row="1"
                                        Grid.ColumnSpan="3"
                                        Margin="5,0,0,0"
                                        BackgroundColor="#bdbdbd"
                                        HeightRequest="1"
                                        HorizontalOptions="FillAndExpand" />
                                </Grid>
                                </ViewCell>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                        <!--<CollectionView.EmptyView>
                            <Label
                                Padding="20,300,55,0"
                                FontSize="30"
                                HorizontalOptions="FillAndExpand"
                                HorizontalTextAlignment="Center"
                                Text="No results found =("
                                TextColor="Gray"
                                VerticalOptions="FillAndExpand" />
                        </CollectionView.EmptyView>-->
                    </ListView>
                    <ContentView x:Name="emptyView" Grid.Row="3" IsVisible="{Binding IsEmpty}" >
                        <Label
                                Padding="20,300,55,0"
                                FontSize="30"
                                HorizontalOptions="FillAndExpand"
                                HorizontalTextAlignment="Center"
                                Text="No results found =("
                                TextColor="Gray"
                                VerticalOptions="FillAndExpand" />
                    </ContentView>
                </Grid>
            </pancakeView:PancakeView>
        </ScrollView>
    </Grid>
</ContentPage>
